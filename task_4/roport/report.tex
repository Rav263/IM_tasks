\documentclass[a4peper, 12pt, titlepage, finall]{extreport}

%различные пакеты

\usepackage[T1, T2A]{fontenc}
\usepackage[russian]{babel}
\usepackage{tikz}
\usepackage{geometry}
\usepackage{indentfirst}
\usepackage{fontspec}


\usetikzlibrary{positioning, arrows}

\geometry{a4paper, left = 15mm, top = 10mm, bottom = 20mm, right = 15mm}

\setmainfont{Times New Roman}
\setmonofont{Courier New}
\setcounter{secnumdepth}{0}


\begin{document}

    \begin{titlepage}
        \begin{center}
            {\small \sc Московский государственный университет имени М.~В.~Ломоносова\\
            Факультет вычислительной математики и кибирнетики\\
            Кафедра автоматизации систем вычислительных комплексов\\}
            \vfill
            {\large \sc Отчёт по заданию №4}\\~\\

            {\large \bf Построение модели сети на основе среды моделирования NS3.}\\~\\

            {\large \bf Вариат №2}
        \end{center}
        
        \begin{flushright}
            \vfill
            {Никифоров Никита Игоревич, 321 группа}
        \end{flushright}

        \begin{center}
            \vfill
            {\small Москва\\2019}
        \end{center}
    \end{titlepage}

    \tableofcontents
    \newpage

    \section{Постановка задачи}
        Необходимо построить модель сети, канала Fast Ethernet на основе среды моделирования NS3. 
        Модель должна состоять из канала FastEthernet и некоторого количества хостов, подлючённых к нему.
        Требуется написать приложение для этих хостов, отсылающее в сеть пакеты с задержкой имеющей экспоненциальное распределение
        с заданным математическим ожиданием.\\
        На осноые построенной модели необходимо:
        \begin{enumerate}
            \item Рассчитать среднее число попыток повторной передачи
            \item среднее и максимальное количество пакетов в буфере устройства
        \end{enumerate}
        Также необходмо было рассчитать количество хостов, чтобы среднее число попыток переотправки пакета не превышало 2.0
    \section{Описание модели}
        Использовалась среда модделирования NS3, за основу была взята модель CSMA канала и устройств.
        Было написано приложение, которое с использованием протокола UDP отправляет пакеты в канал, не дожидаясь отправки предыдущего пакета.
        Задержка между отправкой пакетов задаётся случайной величиной с експоненциальным распределением {\ttfamily$\lambda*e^{-\lambda}$}, 
        задающимся параметром {\ttfamily$\lambda$}. Данная случайная величина была реализована с помощью стандартной библиотеки C++\\
        {\ttfamily std::exponential\_distribution}. Длина канала была представлена в модели как задержка на распространие информации,
        так как нанапрямую длину канала в условиях NS3 задать нельзя. Задержка вычислялась по формуле:
        \begin{center}
            {\ttfamily T = L * 0.01}\\
            Где T - искомая задержка, L - длина канала, 0.01 -- задержка в микросекундах на метр.
        \end{center}
        По данной формуле получаем, что задержка канала - 300нс. В связи с этим случайная величина задержки между пакетами итерпритировалась как 
        милисекунды. Приложение при отправке пакета кладёт его в очередь, как только пакет отправляется,
        устройство достаёт следующий пакет из очереди, если они есть, и пытается отправить его. Устройство в случае занятости канала пытается переотправить
        пакет через случайное время в соответствии с моделей Backoff и стандартом {\ttfamily IEEE 802.3}. Также в моделе присутствует дополнительный хост,
        который имеет функцию сбора пакетов с хостов, и указывается в сокетах как пункт назначения. Пакет сбрасывался, когда при попытке добавить его в очередь, очередь была полностью занята.
    \section{Методы измерения}
        Для измерения искомых характеристик использывались встроенные в NS3 методы {\ttfamily TraceConnect}, которые позволяют на определённое 
        событие запустить определённую функцию. Причём для каждого хоста или канала отдельно назначается список тригеров. Для подсчёта сброшенных пакетов
        на очередь на каждом хосте назначался тригер {\ttfamily Drop}, в функции просто увелисивался счётчик сброшенных пакетов. Для подсчёта
        переотправок пакетов на каждый хост ставился тригер {\ttfamily MacTxBackoff}, в функции вызываемой этим тригером просто увеличивался счётчик попыток переотправки.
        Для подсчёта количества пакетов, которые должны были отправить все хосты использовался счётчик, который увеличивался в функции отправки в приложении.
        Размер очереди вычислялся как суммарное количество значений очереди на кажой генерации пакета (перед помещением его в очередь), 
        делённый на количество сгенерированных пакетов.
    \newpage
    \section{Техническая реализация}
        Для реализации приложения был написан класс {\ttfamily MyApp}, который имеет следующие методы для решения задач поставленных в этой работе:
        \begin{enumerate}
            \item {\ttfamily void Setup(...)} -- метод для задания уникальных параметров этому приложению
            \item {\ttfamily void StartApplication(void)} -- метод для запуска приложения
            \item {\ttfamily void StopApplication(void)} -- метод для остановки приложения
            \item {\ttfamily void ScheduleTx(void)} -- метод для генерации времени отправки нового пакета и указания этого времени симулятору
            \item {\ttfamily void SendPacket(void)} -- метод для генерации и отправки пакета через UDP сокет
            \item {\ttfamily void PritLog(void)} -- метод, работающий только для 0-го хоста, для отображения текущего времени симуляции в лог
        \end{enumerate}
        Для реализации отправки пакетов использовались UDP сокеты, так как UDP протокол позволяет не ждать отправки предыдущего пакета, для генерации нового.
        Для измерения характеристик и логирования были реализованы следующие функции:
        \begin{enumerate}
            \item {\ttfamily void RxBegin(...)} -- метод для отслеживания доставленных пакетов на сервер
            \item {\ttfamily void QueDrop(...)} -- метод для отслеживания сброса пакетов с очереди
            \item {\ttfamily void MacTxBackoff(...)} -- метод для отслеживания переотправки пакетов
        \end{enumerate}
        В главной функции был использован механизм NS3 для передачи параметров программе. 
        \begin{enumerate}
            \item {\ttfamily hosts} -- количество хостов в симуляции, по умолчанию 10
            \item {\ttfamily distr} -- параметр распределения случайной величины времени задержки пакетов
            \item {\ttfamily delay} -- задержка канала связи
        \end{enumerate}
        Данные параметры были использованы для быстрого тестирования программы.
        В главной функции сначала создаётся CSMA канал, затем создаются Nodes, которые мы присоединяем к каналу и получаем хосты.
        Затем для каждого хоста создаётся очередь и передаётся хосту, затем создаётся пул IPv4 адресов {\ttfamily 10.1.0.0 - 10.1.255.255},
        которые потом раздаются хостам. Далее для каждого хоста создаётся объект класса приложения, и устанавливается на хост.
        Устанавливаются временные рамки моделирования, и модель запускается. После окончания моделирования, выводятся значения всех счётчиков и программка завершается.
        Для получения дополнительной информации о ходе экспериментка используются лог файлы и pcap файлы.
    \section{Измерения}
        БЛА БЛА БЛА переделать нормально табличку тут\\
        \begin{tabular}{lccc}
            \bf описание & \bf время моделирования & \bf количество хостов &\bf средняя длина очереди.  \\
        \end{tabular}

    \section{Выводы}
        Таким образом канал длиной 30 метров может поддерживать общение только блабла хостов для.
\end{document}
